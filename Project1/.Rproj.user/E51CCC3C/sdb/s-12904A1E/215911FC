{
    "collab_server" : "",
    "contents" : "########################################################################\n## Get data for Project 2\n## Analyze Project 2 question\n########################################################################\nrm( list = ls( all.names = TRUE ) )\nrm( list = objects( all.names = TRUE ) )\n\n########################################################################\n## Load header files and source functions\n########################################################################\nlibrary( plyr )\nlibrary( ggplot2 )\nlibrary( RFunctionsSN )\nlibrary( xtable )\n########################################################################\n## Command line arguments for some static variables\n########################################################################\n#ProjectPath <- '~/Stat/Stat_Consulting/TraciSnedden/Project2/'\nProjectPath <- '~/Documents/snandi/Stat/Stat_Consulting/TraciSnedden/Project2/'\n\nDataPath <- paste0( ProjectPath, 'Data/' )\nfileNameData <- 'InjuryDataFinal_TotalDays.csv'\nfileNameCodedData <- 'DataCoded.RData'\n\nsource( '../Project1/Codebook.R' )\nsource( paste0( ProjectPath, 'Project2_Static.R' ) )\n\n########################################################################\n## Functions\n########################################################################\nsaveData <- function( Data, folderPath ){\n  fileNameTxt <- 'Project2Data.csv'\n  fileNameR <- 'Project2Data.RData'\n  filePath <- paste0( folderPath, fileNameTxt )\n  write.table( x = Data, file = filePath, quote = F, sep = ',', row.names = F )\n  \n  filePath <- paste0( folderPath, fileNameR )\n  save( Data, file = filePath )\n}\n\nbarPlotByQuestion <- function( TableLong, TitleText ){\n  barPlot <- qplot() + geom_bar( aes( x = Severity, y = Responses, fill = Injury, group = Injury ), \n                                 data = TableLong, position = 'dodge', stat = 'identity' ) +\n    coord_flip() +\n    scale_fill_manual( breaks = c( \"Concussion\", \"Musculoskeletal\" ), values = c( \"red\", \"gray40\" ) ) +\n    xlab( label = '' ) +\n    ggtitle( label = TitleText ) +\n    theme( \n      legend.position = 'top'\n    )\n  \n  return( barPlot )\n}\n\ngetTableByQuestion <- function( DataProject2, Question ){\n  library( reshape2 )\n  varName <- Question\n  varNameCoded <- paste0( Question, '_coded' )\n  DataNoNa <- subset( DataProject2, !( is.na( as.vector( get( varNameCoded ) ) ) ) )\n  DataNoNa[, varNameCoded] <- as.factor( as.vector( DataNoNa[, varNameCoded] ) )\n  Table <- table( DataNoNa$InjuryType, DataNoNa[, varNameCoded] )\n  DataNoNa <- DataNoNa[, c( 'InjuryType', varNameCoded, varName ) ]\n  TableLong <- melt( Table )\n  colnames( TableLong ) <- c( 'Injury', 'Severity', 'Responses' )\n  TableLong$Severity <- factor( TableLong$Severity, Q5.3Levels ) ## Reorder factor levels manually\n  \n  return( list( Table = Table, TableLong = TableLong, DataNoNa = DataNoNa ) )\n}\n\ngetCodedData <- function( folderPath, fileName ){\n  filePath <- paste0( folderPath, fileName )\n  load( filePath )\n  return( DataCoded )\n}\n\ngetProject2Data <- function( folderPath, fileName ){\n  DataCoded <- getCodedData( folderPath, fileName )\n  DataProject2 <- DataCoded[, Project2_VarNames ]\n  colnames( DataProject2 )[colnames( DataProject2 ) == 'Q2.1_coded'] <- 'InjuryType'\n  colnames( DataProject2 )[colnames( DataProject2 ) == 'Q1.1_coded'] <- 'Age'\n  colnames( DataProject2 )[colnames( DataProject2 ) == 'Q1.4_coded'] <- 'Gender'\n  colnames( DataProject2 )[colnames( DataProject2 ) == 'Q1.5_coded'] <- 'Race'\n  colnames( DataProject2 )[colnames( DataProject2 ) == 'Q1.6_coded'] <- 'Ethnicity'\n  colnames( DataProject2 )[colnames( DataProject2 ) == 'Q1.8_coded'] <- 'AcadStatus'\n  colnames( DataProject2 )[colnames( DataProject2 ) == 'Q1.9_coded'] <- 'MentalIllness'\n  colnames( DataProject2 )[colnames( DataProject2 ) == 'Q2.7_TotalDays'] <- 'Days'\n  \n  DataProject2 <- subset( DataProject2, InjuryType == 'Concussion' | InjuryType == 'Musculoskeletal' )\n  \n  DataProject2$InjuryType <- as.factor( as.vector( DataProject2$InjuryType ) )\n  # colnames( DataProject2 ) <- Project2_VarRenames\n  # DataProject2$InjuryType <- NULL\n  return( DataProject2 )\n}\n\n########################################################################\n## Data\n########################################################################\nDataProject2 <- getProject2Data( folderPath = DataPath, fileName = fileNameCodedData )\nsaveData( Data = DataProject2, folderPath = DataPath )\n\nResponses5.3DF <- as.data.frame( cbind( Q5.3Text, pValueChi = 0, pValueT = 0, muDiff = 0 ), \n                                stringsAsFactors = F )\nResponses5.3DF$pValueChi <- as.numeric( Responses5.3DF$pValueChi )\nResponses5.3DF$pValueT <- as.numeric( Responses5.3DF$pValueT )\n\n########################################################################\n## Demographics\n########################################################################\nTableRace <- table( DataProject2$Race, DataProject2$InjuryType )\nTableEth <- table( DataProject2$Ethnicity, DataProject2$InjuryType )\n\nRaceEth <- rbind( TableRace, TableEth ) \nrownames( RaceEth )[6] <- 'NA'\nRaceEth <- RaceEth[ rownames( RaceEth ) != 'NA', ]\n\nTableGender <- table( DataProject2$InjuryType, DataProject2$Gender )\nTableInjury <- table( DataProject2$InjuryType )\nMale <- TableGender[,2]\nFemale <- TableGender[,3]\nTableAge <- aggregate( Age ~ InjuryType, data = DataProject2, FUN = mean )\nSDAge <- aggregate( Age ~ InjuryType, data = DataProject2, FUN = sd )\n\nTable1 <- rbind( t( TableInjury ), t( Male ), t( Female ), \n                 as.character( round( as.numeric( t( TableAge )[2,] ), 2) ),\n                 as.character( round( as.numeric( t( SDAge )[2,] ), 2) ) )\n\nrownames( Table1 ) <- c( 'N', 'N (males)', 'N (females)', 'Average Age', 'Std Dev Age' )\n\nTable1 <- rbind( Table1, RaceEth )\n\nTableDays <- round( aggregate( Days ~ InjuryType, data = DataProject2, FUN = mean )[, 2], 0 )\nTable1 <- rbind( Table1, TableDays )\n\nTableHistory <- table( DataProject2$MentalIllness, DataProject2$InjuryType )\nrownames( TableHistory ) <- c( \"NA\", \"ADHD/ADD\", \"Learning Disability\", \"Psychiatric Disorder\", \n                               \"Migraine Headaches\", \"None\" )\nTable1 <- rbind( Table1, TableHistory )\n\ni <- 1\nfor( i in 1:22 ){\n  Question <- paste0( 'Q5.3_', i )\n  ## 1 Get tables\n  Tables <- getTableByQuestion( DataProject2, Question )\n\n  ## 2 Chi-square test\n  TestChi <- chisq.test( Tables$Table )\n  pValueChi <- round( TestChi$p.value, 5 )\n  \n  Responses5.3DF[Question, 'pValueChi'] <- pValueChi\n\n  ## 3 T test\n  DataNoNa <- Tables$DataNoNa\n  dataConc <- subset( DataNoNa, InjuryType == 'Concussion' )[, Question ]\n  dataMusc <- subset( DataNoNa, InjuryType == 'Musculoskeletal' )[, Question ]\n  TestT <- t.test( x = dataConc, y = dataMusc, alternative = \"greater\", var.equal = T )\n  pValueT <- round( TestT$p.value, 5 )\n  muDiff <- round( diff( TestT$estimate ), 2 )\n  \n  Responses5.3DF[Question, 'pValueT'] <- pValueT\n  Responses5.3DF[Question, 'muDiff'] <- muDiff\n  \n  ## 4 Bar plot\n  # barPlot <- barPlotByQuestion( TableLong = Tables$TableLong, TitleText = Q5.3Text[[ Question ]] )\n  # Question <- gsub( pattern = \"\\\\.\", replacement = \"_\", x = Question )\n  # filePath <- paste0( ProjectPath, Question, '_barPlot.pdf' )    \n  # ggsave( filename = filePath, plot = barPlot, device = 'pdf', height = 6, width = 8 )\n  # \n  # filePath <- paste0( ProjectPath, Question, '_barPlot.jpg' )    \n  # ggsave( filename = filePath, plot = barPlot, device = 'jpeg', height = 6, width = 8 )\n}\n\nprint( xtable( Responses5.3DF, align = \"llrrr\", caption = \"Responses By Injury Type\", \n               label = \"tab:Tab1Summary\" ), table.placement = \"H\" )\n\n\n",
    "created" : 1490496962699.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "30|41|38|0|\n40|54|52|0|\n54|57|67|0|\n69|49|73|0|\n",
    "hash" : "467623353",
    "id" : "215911FC",
    "lastKnownWriteTime" : 1490511153,
    "last_content_update" : 1490511153863,
    "path" : "~/Documents/snandi/Stat/Stat_Consulting/TraciSnedden/Project2/Project2_Analysis.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}